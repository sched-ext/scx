---
title: Full BPF arena support
status: open
priority: 2
issue_type: feature
depends_on:
  sim-6ba30: parent-child
created_at: 2026-02-13T19:30:00.000000000+00:00
updated_at: 2026-02-13T19:30:00.000000000+00:00
---

# Description

The simulator currently stubs out BPF arena functionality with a minimal
malloc-based replacement (`sim_sdt_stubs.c`). This is sufficient for LAVD,
which only uses arenas for per-task context storage via the SDT task API
(`scx_task_alloc`/`scx_task_data`/`scx_task_free`).

Future schedulers may use arenas more directly. Full support would require:

- `bpf_arena_alloc_pages` / `bpf_arena_free_pages` — page-granularity
  allocation from a contiguous arena region
- SDT allocator internals (`scx_alloc`, `scx_alloc_free_idx`) — radix-tree
  based chunk allocator
- Buddy allocator (`scx_buddy_alloc/free`) — power-of-2 free list
- Stack allocator (`scx_stk_push/pop`) — segment-based page stack
- Static allocator (`scx_static_alloc`) — lifetime allocation, never freed
- Pool allocator (`sdt_pool_alloc/free`) — slab-style fixed-size allocation
- `cast_kern()` / `cast_user()` — address space conversion (no-op in
  userspace but may need semantic handling)
- Shared userspace/BPF memory semantics

## Current status

What works today (via sim_sdt_stubs.c):
- `scx_task_init(data_size)` — records allocation size
- `scx_task_alloc(p)` — calloc + hash table insert
- `scx_task_data(p)` — hash table lookup
- `scx_task_free(p)` — free + hash table erase
- `scx_arena_subprog_init()` — no-op (BPF verifier workaround)

This covers LAVD and any scheduler that only uses the SDT per-task storage
API. Only implement full arena support when a scheduler actually needs it.
