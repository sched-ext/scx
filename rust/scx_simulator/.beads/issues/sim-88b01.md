---
title: Implement idle scanning modes (flat + preferred)
status: open
priority: 2
issue_type: feature
depends_on:
  sim-5a20c: blocks
created_at: 2026-02-13T13:04:30.859974537+00:00
updated_at: 2026-02-13T13:07:58.515642365+00:00
---

# Description

COSMOS supports multiple idle CPU scanning strategies beyond the default
scx_bpf_select_cpu_dfl (flat_idle_scan=false, preferred_idle_scan=false disable
these). When enabled:

- pick_idle_cpu_flat(): Round-robin scan using last_cpu state, with SMT-aware
  full-core preference. Bypasses scx_bpf_select_cpu_dfl entirely.
- pick_idle_cpu_pref_smt(): Capacity-preferred scanning using preferred_cpus[]
  array (based on CPU performance/capacity ordering).

Work needed:
- Implement the idle CPU scanning infrastructure that these functions rely on
- Support preferred_cpus[] configuration
- Add COSMOS test configs with flat_idle_scan=true and preferred_idle_scan=true
- Depends on SMT topology simulation (sim-5a20c) for full-core scanning

This is closely coupled with SMT simulation since both flat and preferred
scanning use SMT masks.
